   - name: Extract tfvars from issue body
        id: parse
        run: |
          echo "${{ github.event.issue.body }}" > issue.txt
          # The form must include the 'Full Terraform Vars' textarea (config_blob).
          # Read config_blob (JSON or markdown extraction) and fail if missing.
          CONFIG_BLOB=""
          if echo "$(cat issue.txt)" | jq -r . >/dev/null 2>&1; then
            CONFIG_BLOB=$(jq -r '.config_blob // empty' issue.txt || true)
            WS_ORG=$(jq -r '.workspace_organization // empty' issue.txt || true)
            WS_HOST=$(jq -r '.workspace_hostname // empty' issue.txt || true)
            WS_NAME=$(jq -r '.workspace_name // empty' issue.txt || true)
            JFROG_TOKEN=$(jq -r '.jfrog_token // empty' issue.txt || true)
          else
            # Extract the textarea content from the issue form markdown (the Full Terraform Vars block)
            CONFIG_BLOB=$(awk 'BEGIN{found=0} /^### Full Terraform Vars/{found=1; next} /^### /&&found{exit} found{print}' issue.txt | sed '/^\s*$/d' || true)
            CONFIG_BLOB=$(echo "$CONFIG_BLOB" | sed '1s/^```//; $s/```$//' || true)
            getval() { awk -v k="$1" 'f&&$0!~/^\s*$/&&$0!="_No response_"{print;exit} $0~"^### "k{f=1}' issue.txt; }
            WS_ORG=$(getval "Statefile JFrog repo name" || true)
            WS_HOST=$(getval "Statefile JFrog hostname" || true)
            WS_NAME=$(getval "Statefile workspace name" || true)
            JFROG_TOKEN=$(getval "JFrog Token" || true)
          fi

          # Require CONFIG_BLOB to be present; fail early with helpful message
          if [ -z "$(printf '%s' "$CONFIG_BLOB" | sed -n '1p')" ]; then
            echo "ERROR: 'Full Terraform Vars' (config_blob) is required in the issue form. Aborting." >&2
            exit 1
          fi

          # Write the provided config_blob directly to issue.auto.tfvars
          printf '%s' "$CONFIG_BLOB" > issue.auto.tfvars
          echo "Wrote issue.auto.tfvars from config_blob content"

          # Export workspace and jfrog values to GITHUB_ENV (do NOT inject them into issue.auto.tfvars)
          echo "WS_ORG=$WS_ORG" >> $GITHUB_ENV
          echo "WS_HOST=$WS_HOST" >> $GITHUB_ENV
          echo "WS_NAME=$WS_NAME" >> $GITHUB_ENV
          echo "JFROG_TOKEN=$JFROG_TOKEN" >> $GITHUB_ENV

      - name: Echo Terraform form values
        run: |          
          echo "=== Parsed tfvars for Terraform ==="
          cat issue.auto.tfvars
          # ensure a blank line so the following labels appear on their own lines
          echo ""
          echo "Workspace Organization: $WS_ORG"
          echo "Workspace Hostname: $WS_HOST"
          echo "Workspace Name: $WS_NAME"
